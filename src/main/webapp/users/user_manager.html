<table id="user_tables"></table>
<script>
	$(function() {
		var windowId = '$windowId';
		var this_window = $("#" + windowId);
		// 		alert(this_window.html());
		// 		$.ds.commons.openDialog("user_role_config", $.ds.icon.user + "&nbsp;" + $.ds.icon.role, "用户角色配置", "user_role_config.html");

		// 刷新
		var a_reload = $('<a href="javascript:void(0)" class="icon-reload"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_reload);
		a_reload.click(function() {
			table.datagrid('reload');
		});
		// 编辑
		var a_edit = $('<a href="javascript:void(0)" class="icon-edit"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_edit);
		a_edit.click(function() {
			var selected = table.datagrid('getSelected');
			var idx = table.datagrid('getRowIndex', selected);
			if (selected == undefined || selected == null) {
				$.ds.show('请选择一个用户！');
				return;
			}
			$.ds.commons.openDialog("user_add", $.ds.icon.user, "用户编辑", "users/user_add.html", "id=" + selected.id, {
				onClose : function() {
					table.datagrid('reload', function() {
						table.datagrid('selectRow', idx);
					});
				}
			}).dialog('resize', {
				height : 420
			});
		});
		// 增加
		var a_add = $('<a href="javascript:void(0)" class="icon-add"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_add);
		a_add.click(function() {
			$.ds.commons.openDialog("user_add", $.ds.icon.user, "用户增加", "users/user_add.html", null, {
				onClose : function() {
					table.datagrid('getPager').pagination('select', 99999999);
				}
			}).dialog('resize', {
				height : 420
			});
		});
		// 角色添加
		var a_man = $('<a href="javascript:void(0)" class="icon-man"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_man);
		a_man.click(function() {
			var selected = table.datagrid('getSelected');
			var idx = table.datagrid('getRowIndex', selected);
			if (selected == undefined || selected == null) {
				$.ds.show('请选择一个用户！');
				return;
			}
			$.ds.commons.openDialog("user_add_role", $.ds.icon.role, "设置角色", "users/user_add_role.html", "id=" + selected.id).dialog('resize', {
				height : 350
			});
		});

		var table = $("#user_tables");
// 		this_window.append(table);
		table.datagrid({
			url : $.ds.url.find_user_by_page,
// 			queryParams : { execute_time : execute_time, status_id : '' },
			method : 'post',
// 			toolbar : "#rp_center_task div[rp_index='rp_task_list_all_search']",
			singleSelect : true,
			onBeforeLoad : function(param) {
			},
			onLoadSuccess : function() {
// 				alert(JSON.stringify(data));
			},
			columns : [ [ {
				field : 'id',
				title : 'id',
				hidden : true
			}, {
				field : 'userName',
				title : '用户名',
				width : "15%"
			}, {
				field : 'userNameCn',
				title : '中文名',
				width : "15%"
			}, {
				field : 'phoneNumber',
				title : '电话号码',
				width : "15%",
				align : 'right'
			}, {
				field : 'email',
				title : '邮箱',
				width : "20%",
				align : 'right'
			}, {
				field : 'remark',
				title : '备注',
				width : "30%",
				align : 'right'
			} ] ],
			rownumbers : true,
			singleSelect : true,
			autoRowHeight : false,
			pagination : true,
			striped : true,
			pageSize : 10,
			pagePosition : 'bottom'
		}).datagrid('getPager').pagination({
			pageList : [ 10, 20, 50, 100 ],
			links : 5,
			displayMsg : '当前显示　{from} - {to}　条记录,共　{total}　条记录',
			layout : [ 'list', 'sep', 'first', 'prev', 'sep', 'links', 'sep', 'next', 'last', 'sep', 'refresh' ]
		});
// 		table.datagrid({
// 			pagination : true,
// 			columns : [ [ {
// 				field : 'userName',
// 				title : '用户名',
// 				width : "20%"
// 			}, {
// 				field : 'userNameCn',
// 				title : '中文名',
// 				width : "20%"
// 			}, {
// 				field : 'email',
// 				title : '邮箱',
// 				width : "20%",
// 				align : 'right'
// 			}, {
// 				field : 'phoneNumber',
// 				title : '电话号码',
// 				width : "20%",
// 				align : 'right'
// 			} ] ]
// 		});
	});
</script>
